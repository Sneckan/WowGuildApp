@model WowGuildApp.ViewModels.EventDetailViewModel
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager

@{
    ViewData["Title"] = "Details";
}

<h2>Details</h2>

<div>
    <h4>Event</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Event.Title)
        </dt>
        <dd>
            @Model.Event.Title
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.Event.Date)
        </dt>
        <dd>
            @Model.Event.Date.ToString("dd/MM/yyyy")
        </dd>
        <dt>
            Raidleader
        </dt>
        <dd>
            @Model.Host.UserName
        </dd>
        @if (Model.Event.Description != null)
        {
            <dt>
                @Html.DisplayNameFor(model => model.Event.Description)
            </dt>
            <dd>
                @Model.Event.Description
            </dd>
        }
        <dt>
            Invite Time
        </dt>
        <dd>
            @Model.Event.InviteTime.ToString("HH:mm")
        </dd>
        <dt>
            Start Time
        </dt>
        <dd>
            @Model.Event.StartTime.ToString("HH:mm")
        </dd>
        <dt>
            Last Signup
        </dt>
        <dd>
            @Model.Event.LastSignup.ToString("HH:mm")
        </dd>
    </dl>
</div>
<div class="row">
    <div class="col">

    @if (SignInManager.IsSignedIn(User) && UserManager.GetUserId(User) == Model.Event.hostId)
    {
        <a asp-action="Edit" asp-route-id="@Model.Event.Id" class="btn btn-primary">Edit</a>
        <a asp-action="Delete" asp-route-id="@Model.Event.Id" class="btn btn-danger">Delete</a>
    }
    <a asp-action="Index">Back to List</a>

    </div>
    <div class="col">
        <form asp-action="UnSign" method="post" class="float-right">
            <input type="hidden" asp-for="Signup.UserId" value="@UserManager.GetUserId(User)" />
            <input type="hidden" asp-for="Signup.EventId" value="@Model.Event.Id" />
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#signUpForm" @if(DateTime.Now > Model.Event.LastSignup){ <text>disabled</text>}>Signup</button>
            <button type="submit" class="btn btn-danger" value="Unsign">Unsign</button>
        </form>
        <div class="modal fade" id="signUpForm" tabindex="-1" role="dialog" aria-labelledby="Sign Up" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="signUpFormTitle">Chose Role</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form asp-action="Signup" method="post">
                        <div class="modal-body">
                            <input type="hidden" asp-for="Signup.UserId" value="@UserManager.GetUserId(User)" />
                            <input type="hidden" asp-for="Signup.EventId" value="@Model.Event.Id" />

                            <div class="form-group form-check">
                                <label class="form-check-label">
                                    <input class="form-check-input" data-val="true" data-val-required="The RoleDps field is required." id="Signup_RoleDps" name="Signup.RoleDps" type="checkbox" value="true">
                                    Damage
                                </label>
                            </div>

                            <div class="form-group form-check">
                                <label class="form-check-label">
                                    <input class="form-check-input" data-val="true" data-val-required="The RoleHealer field is required." id="Signup_RoleHealer" name="Signup.RoleHealer" type="checkbox" value="true">
                                    Healer
                                </label>
                            </div>

                            <div class="form-group form-check">
                                <label class="form-check-label">
                                    <input class="form-check-input" data-val="true" data-val-required="The RoleTank field is required." id="Signup_RoleTank" name="Signup.RoleTank" type="checkbox" value="true">
                                    Tank
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <input type="submit" class="btn btn-primary" value="Signup" />
                        </div>
                    </form>
                </div>
            </div>
        </div>

        
    </div>
</div>

<div>
    
    <div>
        <div class="row">
            <h2 class="mx-auto">Signed</h2>
        </div>
        <div class="row">
            
            <div class="col">
                <h3>Damage Dealer</h3>
                <ul class="list-group">
                    @foreach (Signup s in Model.Signups.Where(s => s.Sign == true && s.RoleDps==true))
                    {
                        <li class="list-group-item">
                            @s.User.UserName
                        </li>
                    }
                </ul>
            </div>
            <div class="col">
                <h3>Healer</h3>
                <ul class="list-group">
                    @foreach (Signup s in Model.Signups.Where(s => s.Sign == true && s.RoleHealer==true))
                    {
                        <li class="list-group-item">
                            @s.User.UserName
                        </li>
                    }
                </ul>
            </div>
            <div class="col">
                <h3>Tank</h3>
                <ul class="list-group">
                    @foreach (Signup s in Model.Signups.Where(s => s.Sign == true &&s.RoleTank==true))
                    {
                        <li class="list-group-item">
                            @s.User.UserName
                        </li>
                    }
                </ul>
            </div>
        </div>
        <hr />
        <div class=" row">
            <h2 class="mx-auto">Unsigned</h2>
        </div>
        <div class="row">
            
            <div class="col">
                <ul class="list-group">
                    @foreach (Signup s in Model.Signups.Where(s => s.Sign == false))
                    {
                        <li class="list-group-item">
                            @s.User.UserName
                        </li>
                    }
                </ul>
            </div>
        </div>

    </div>
</div>
